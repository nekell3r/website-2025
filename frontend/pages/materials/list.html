<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0" >
        <script src="scripts/payment.js" defer></script>
        <title>МАТЕРИАЛЫ ДЛЯ УРОКОВ</title>
        <link rel="stylesheet" href="../../assets/css/style_materials.css">
        <style>
            body {
                display: flex;
                flex-direction: column; 
                justify-content: center; 
                align-items: center; 
                font-family: Comic Sans MS, Comic Sans, cursive;
                margin:0px;
                padding: 0px;
                background-color: #3A3A3A
            }
        </style>
    </head>
<body>
    <div class="header2">
        <div class="logo">
            <a href="../../index.html"><img src="../../assets/img/злой рус.png" class="zloy" alt="Злой Русский"></a>
        </div>
        <div class="menu">
            <a href="../exams/oge.html">ОГЭ</a>
            <a href="../exams/ege.html">ЕГЭ</a>
            <a href="list.html"><b>МАТЕРИАЛЫ ДЛЯ УРОКОВ</b></a>
        </div>
        <div class="buttons">
            <button class="menu-button" onclick="toggleMenu()">
                <img src="../../assets/img/new_hambur.png" style="margin: -18px 0px 10px -10px; width: 50px;" alt="кнопка меню">
            </button>
        </div>
    </div>
    <div class="text_material">
        <b><h1>Продукт "материалы для уроков" содержит готовые разработки(рабочие листы и презентации)
            для использования преподавателями.</h1></b><br>
        <b><h2>Материалы по русскому языку и литературе вы можете приобрести отдельно, 
            в личном кабинете они тоже будут отображаться, как разные продукты.</h2></b>
        <b><h2>Все файлы оформлены в виде PDF-файлов. При покупке продукта вы получаете ссылки на скачивание всех разработок.</h2></b>
        <b><h2>К каждому материалу имеется текстовое описание с его типом(презентация или рабочие листы) и темой.</h2></b>
    </div>

    <div class="two-column-block"> 
        <div class="column">
            <b><h1 class="russ-liter">Русский язык</h1></b> 
            <img src = "../../assets/img/mestoim.png" alt="Левое изображение">
            <img src = "../../assets/img/znaki.png" alt="Левое изображение">
            <b><h2 class="russ-liter">Стоимость продукта - x рублей</h2></b>
            <div>
                <input style="width:109%; transform: translateX(-22px); padding: 8px 10px; margin-bottom: 10px"  type="text" id="userInput-lru" placeholder="email для отправки чека" onclick="clearPlaceholder(this)">
            </div>
            <div class="error-message" id="emailError-lru">Пожалуйста, введите email!</div>
            <button style="width: 39%; margin-top: 17px;" class="payment-button" data-product-slug="lru" data-input-id="userInput-lru" data-error-id="emailError-lru">Страница оплаты</button>
        </div>
        
        <div class="column">
            <b><h1 class="russ-liter">Литература</h1></b> 
            <img src = "../../assets/img/belgorod.png" alt="Правое изображение">
            <img src = "../../assets/img/klassiz.png" alt="Правое изображение">
            <b><h2 class="russ-liter">Стоимость продукта - x рублей</h2></b>
            <div>
                <input style="width:109%; transform: translateX(-22px); padding: 8px 10px; margin-bottom: 10px"  type="text" id="userInput-llit" placeholder="email для отправки чека" onclick="clearPlaceholder(this)">
            </div>
            <div class="error-message" id="emailError-llit">Пожалуйста, введите email!</div>
            <button style="width: 39%; margin-top: 17px;" class="payment-button" data-product-slug="llit" data-input-id="userInput-llit" data-error-id="emailError-llit">Страница оплаты</button>
        </div>
    </div>


    <div style="position: relative;
    text-align: center;">
        <b><h2>Так же вы можете приобрести оба продукта по сниженной цене - в личном кабинете они будут отображаться отдельно.</h2></b><br>
        <b><h2>Стоимость пары продуктов - y рублей</h2></b>
        <div class="column">
                <input style="width:16%; transform: translateX(-4px); padding: 15px 10px; margin-bottom: 10px"  type="text" id="userInput-llitru" placeholder="email для отправки чека" onclick="clearPlaceholder(this)">
            </div>
            <div class="error-message" id="emailError-llitru">Пожалуйста, введите email!</div>
            <button style="width: 23%; margin-top: 17px;" class="payment-button" data-product-slug="llitru" data-input-id="userInput-llitru" data-error-id="emailError-llitru">Страница оплаты</button>
        </div>    
        </div>  


    <div class="text_and_line-container">
        <b><h1 style="display: flex;">Возможны способы оплаты - СБП, Карта МИР, Т-pay</h1></b>
    </div>

    <div class="the_end" style="padding-top: 20px">
        <h1 style="flex: 1;
        text-align: center;">Служебная информация</h1>
        <img src="../../assets/img/злой рус.png" class="zloy_ru" alt="злой рус">
    </div>

    <script>

        const inputField = document.getElementById('userInput');
    const originalPlaceholder = inputField.placeholder;
    
    // Обработчик клика по полю ввода
    inputField.addEventListener('focus', function() {
        this.placeholder = '';
    });
    
    // Обработчик клика вне поля ввода
    document.addEventListener('click', function(event) {
        if (event.target !== inputField) {
            if (inputField.value === '') {
                inputField.placeholder = originalPlaceholder;
            }
        }
    });
    </script>

    <div class="dropdown" id="dropdown">
        <span class="close" onclick="toggleMenu()">&times;</span>
        <a href="../auth/login.html">авторизация/личный кабинет</a>
        <a href="../exams/responses/ege-response.html">отзывы</a>
        <a href="questions.html">FAQ</a>
    </div>

<script>
    function toggleMenu() {
        var menu = document.getElementById("dropdown");
        menu.classList.toggle("active");
    }
    
    // Добавляем обработчик для кнопки авторизации
    document.getElementById('auth-link').addEventListener('click', async function(e) {
    e.preventDefault();
    
    try {
        const response = await fetch('https://slick-rice-heal.loca.lt/me/info', {
            method: 'GET',
            credentials: 'include',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'ngrok-skip-browser-warning': 'true' // Обход предупреждения ngrok
            }
        });
        
        if (response.status === 401) {
            // Пользователь не авторизован
            window.location.href = '/auto.html';
            return;
        }

        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const userData = await response.json();
        handleUserData(userData);
        if (userData && userData.id && userData.name) {
            // Сохраняем данные пользователя перед переходом
            sessionStorage.setItem('userData', JSON.stringify(userData));
            
            // Перенаправляем в личный кабинет
            window.location.href = 'lk.html';
        } else {
            throw new Error('Получены некорректные данные пользователя');
        }
        
    } catch (error) {
        console.error('Ошибка:', error);
        // Попробуем альтернативный подход без credentials
        tryAlternativeApproach();
    }
});

async function tryAlternativeApproach() {
    try {
        const response = await fetch('https://slick-rice-heal.loca.lt/me/info', {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'ngrok-skip-browser-warning': 'true'
            }
        });
        
        const data = await response.json();
        console.log('Успешно (без куки):', data);
        handleUserData(data);
    } catch (error) {
        console.error('Ошибка альтернативного запроса:', error);
        alert('Не удалось получить данные. Пожалуйста, войдите в систему.');
        window.location.href = 'auto.html';
    }
}
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="../../assets/js/script.js"></script>

</body>
</html>
